# Сканер портов
## Реализация
![alt text](https://github.com/dashdown/tcpscan/blob/dashdown-patch-1/how_it_works.jpg "Схематическое описание реализации")

## Недостатки реализации
* Корутины (scan_worker), которые запускают задачи по сканированию портов, создаются пачкой для сканирования конкретного хоста. Аналогичная ситуация с тем, что на каждую задачу сканирования порта открывается случайный сокет. А можно за этими корутинами закрепить определенные сокеты и выдавать их (корутины) через фабричный метод. Хотя, наверное, достаточно было бы поместить их в список в глобальной области видимости. 
* Параметры типа timeout, scanners_count (и еще парочка) нельзя настроить снаружи кода. Для host/port удобно было бы оставить по дефолту 127.0.0.1:8080, но еще и задаваемым при запуске `python main.py 192.57.242.15 8008`.
* Состояние подключения клиента не отслеживается. Если клиент обрывает соединение, скан портов продолжается. А можно останавливать скан, поскольку результат присылать уже некому. 
* Отсутствует обработка ошибки `aiohttp.http_exceptions.BadStatusLine: invalid HTTP method`, возникающей при обращении по HTTPS. Приложение от этого НЕ крашится, но замалчивать явно не удается. 
* Структуры, осуществляющие сканирование портов, можно выделить в отдельный модуль. В main же желательно оставить только логику запуска приложения и обработки запросов. 
* Нельзя покрыть тестами. Можно было бы завернуть обработчик запроса, корутину request_worker и используемые ими очереди в класс: у них и так высокая связность. Так уже можно сделать окружение `web.Application()` воссоздаваемым, а значит тестируемым. В тестах логи отключил бы в `logging.disable()`.
* Сканирование дает ложно-отрицательные результаты, если связи со сканируемым хостом нет. Даже если есть открытые TCP-порты, app скажет, что закрыты все. 

## Постановка задачи
Требуется разработать web-приложение для сканирования открытых TCP поротв удаленного хоста.
Приложение должно реализовать следующее REST API: `GET /scan/<ip>/<begin_port>/<end_port>`. Параметры:
* ip - хост, который необходимо просканировать
* begin_port - начала диапозона портов для сканирования
* end_port - конец диапозона портов для сканирования

Обработчик данного урла - запускает сканирование указанного хоста, и отдает информацию клиенту в формате JSON (можно частями). Формат ответа: `[{"port": "integer", "state": "(open|close)"}]`.

Требования к программе:
* Aiohttp (>= 3.2.0);
* Python (>= 3.5);
* Логирование syslog - входящие запросы, ошибки и т.д.

Будет плюсом (не обязательно, но желательно):
* Наличие тестов (AioHTTPTestCase);
* Готовый spec-файл для сборки RPM-пакета.

Предпочтительные средства реализации:
* Образ системы Fedora 31.

Результат:
* Код, расположенный на git-репозитории (например, github).